# KotobaTranscriber

**日本語音声文字起こしアプリケーション**

KotobaTranscriberは、日本語の音声・動画ファイルを高精度でテキストに変換するデスクトップアプリケーションです。最新のAI技術（Kotoba-Whisper）を使用し、フォルダ監視による自動処理、話者分離、LLM補正など、プロフェッショナルな文字起こし機能を提供します。

![KotobaTranscriber Icon](icon.ico)

## 主な機能

### 🎯 基本機能
- **高精度な日本語文字起こし**: Kotoba-Whisperモデルによる最先端の音声認識
- **GPU対応**: CUDA対応GPU使用で高速処理
- **複数ファイル対応**: バッチ処理で一度に複数ファイルを処理
- **豊富な対応フォーマット**: MP3, WAV, M4A, FLAC, OGG, AAC, MP4, AVI, MOV, MKVなど

### 📁 フォルダ監視機能
- **自動監視**: 指定フォルダを監視し、新規ファイルを自動文字起こし
- **カスタマイズ可能**: 監視間隔を10秒〜300秒で調整可能
- **処理済みファイル管理**: 重複処理を自動回避
- **自動移動**: 処理完了ファイルを自動的に指定フォルダへ移動

### ✨ 高度な機能
- **話者分離**: 複数話者の自動検出と話者ごとのテキスト分割
- **LLM補正**: Claude AI使用による高度な文章校正と整形
- **フィラー語削除**: 「あー」「えー」「ごめん」などの不要な口語表現を自動削除
- **カスタム語彙**: 専門用語や固有名詞の認識精度向上
- **音声前処理**: ノイズ除去、VAD（音声区間検出）による処理最適化

### 🚀 利便性
- **多重起動防止**: 安全なシングルインスタンス動作
- **システムトレイ常駐**: バックグラウンドで動作
- **Windows起動時自動実行**: 設定でON/OFF可能
- **コンパクトUI**: 280x450の超省スペース設計
- **ツールチップヘルプ**: 各ボタンにマウスホバーで簡単説明を表示

## システム要件

### 必須環境
- **OS**: Windows 10/11 (64-bit)
- **Python**: 3.8以上
- **メモリ**: 8GB以上推奨
- **ストレージ**: 5GB以上の空き容量

### 推奨環境
- **GPU**: NVIDIA CUDA対応GPU（RTX 3060以上）
- **メモリ**: 16GB以上
- **VRAM**: 6GB以上

## インストール

### 1. リポジトリのクローン
```bash
git clone <repository-url>
cd KotobaTranscriber
```

### 2. 仮想環境の作成
```bash
python -m venv venv
venv\Scripts\activate
```

### 3. 依存パッケージのインストール
```bash
pip install -r requirements.txt
pip install pywin32  # 多重起動防止に必要
```

### 4. CUDA環境のセットアップ（GPU使用時）
```bash
# CUDA 11.8の例
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
```

詳細は [CUDA_SETUP.md](docs/CUDA_SETUP.md) を参照してください。

## 使用方法

### アプリケーションの起動

```bash
# 仮想環境を有効化
venv\Scripts\activate

# アプリケーションを起動
python src/main.py
```

または、`startup.bat`をダブルクリックして起動することも可能です。

### 基本的な使い方

#### 1. 単一ファイルの文字起こし

1. **ファイル選択**ボタンをクリック
2. 音声/動画ファイルを選択
3. 必要に応じてオプションを設定:
   - フィラー語削除
   - 話者分離
   - LLM補正
4. **文字起こし開始**ボタンをクリック
5. 処理完了後、同じフォルダに`<ファイル名>_文字起こし.txt`が生成されます

#### 2. 複数ファイルのバッチ処理

1. **複数ファイル選択**ボタンをクリック
2. 処理したいファイルを複数選択（Ctrl+クリックまたはShift+クリック）
3. オプションを設定
4. **文字起こし開始**ボタンをクリック
5. すべてのファイルが順次処理されます

#### 3. フォルダ監視による自動処理

1. **監視フォルダ選択**ボタンをクリック
2. 監視したいフォルダを選択
3. **監視間隔**を設定（デフォルト: 60秒）
4. **フォルダ監視開始**ボタンをクリック
5. 選択したフォルダに音声/動画ファイルを追加すると、自動的に文字起こしが実行されます

**自動移動機能**:
- 「完了ファイル自動移動」をONにすると、処理完了後にファイルと文字起こし結果を指定フォルダへ自動移動

### オプション機能の詳細

#### テキスト整形オプション

| オプション | 説明 |
|----------|------|
| フィラー語削除 | 「あー」「えー」「ごめん」などの口語表現を削除 |
| 句読点整形 | 適切な位置に句読点を自動挿入 |
| 話者分離 | 複数話者を自動検出し、発言者ごとに分割 |
| LLM補正 | Claude AIによる高度な文章校正（要API設定） |

#### 高度な設定

| 設定 | 説明 |
|-----|------|
| 音声前処理 | ノイズ除去とVADによる処理最適化 |
| カスタム語彙 | 専門用語の認識精度向上（custom_vocabulary.json） |
| Windows起動時に実行 | PC起動時に自動でアプリを起動 |

### カスタム語彙の設定

専門用語や固有名詞の認識精度を向上させるには:

1. 「語彙管理」ボタンをクリック
2. 語彙管理ダイアログで単語を追加
3. または、`custom_vocabulary.json`を直接編集

```json
[
  "エイジェック",
  "コトバウィスパー",
  "リアルタイム処理"
]
```

### LLM補正の設定

1. `config/config.yaml`を開く
2. `llm_correction`セクションにAPIキーを設定:

```yaml
llm_correction:
  enabled: false
  api_key: "your-claude-api-key-here"
  model: "claude-3-5-sonnet-20241022"
```

3. アプリケーションを再起動

## ショートカットキー

現在、ショートカットキーは実装されていませんが、将来のバージョンで追加予定です。

## トラブルシューティング

### Q: GPU が認識されない

**A**: CUDA環境が正しくインストールされているか確認してください。

```bash
python -c "import torch; print(torch.cuda.is_available())"
```

`False`の場合は、[CUDA_SETUP.md](docs/CUDA_SETUP.md)を参照してCUDAを再インストールしてください。

### Q: 文字起こしが途中で止まる

**A**: 以下を確認してください:
- メモリ不足: タスクマネージャーでメモリ使用状況を確認
- GPU VRAM不足: より小さいモデルを使用するか、CPUモードに切り替え
- ログファイル`logs/app.log`でエラーを確認

### Q: フォルダ監視が動作しない

**A**:
1. 監視フォルダのパスが正しいか確認
2. フォルダに対する読み書き権限があるか確認
3. `.processed_files.txt`が破損していないか確認

### Q: 多重起動防止が機能しない

**A**: `pywin32`がインストールされているか確認してください:

```bash
pip install pywin32
```

## ログファイル

アプリケーションログは以下に保存されます:

- **アプリケーションログ**: `logs/app.log`
- **起動ログ**: `startup.log`（アプリケーションルートディレクトリ）

ログレベルはデフォルトでINFOですが、`config/config.yaml`で変更可能です。

## 設定ファイル

### app_settings.json
ユーザー設定を保存:
- ウィンドウ位置・サイズ
- 監視フォルダパス
- オプション設定

### config/config.yaml
システム設定:
- モデルパス
- LLM設定
- ログレベル

### custom_vocabulary.json
カスタム語彙リスト（オプション）

## ファイル構成

```
KotobaTranscriber/
├── src/
│   ├── main.py                 # メインアプリケーション
│   ├── transcription_engine.py # 文字起こしエンジン
│   ├── text_formatter.py       # テキスト整形
│   ├── folder_monitor.py       # フォルダ監視
│   ├── speaker_diarization_free.py # 話者分離
│   ├── llm_corrector_standalone.py # LLM補正
│   └── app_settings.py         # 設定管理
├── config/
│   └── config.yaml            # システム設定
├── docs/                      # ドキュメント
├── tests/                     # テストコード
├── icon.ico                   # アプリケーションアイコン
├── app_settings.json          # ユーザー設定
├── custom_vocabulary.json     # カスタム語彙
└── README.md                  # このファイル
```

## 技術仕様

### 使用技術

- **UI Framework**: PySide6 (LGPL v3 - 商用利用可能)
- **音声認識**: Kotoba-Whisper, Faster-Whisper
- **AI補正**: Transformers (ローカルLLM)
- **話者分離**: SpeechBrain
- **音声処理**: librosa, soundfile
- **GPU加速**: CUDA, PyTorch

### モデル

- **デフォルトモデル**: `kotoba-tech/kotoba-whisper-v2.0`
- **代替モデル**: Faster-Whisper互換モデル

## 貢献

バグ報告や機能リクエストは、Issueにて受け付けています。

## ライセンス

MIT License

## 更新履歴

### v2.1.0 (2025-10-19)
- **PySide6への移行** - ライセンス問題解決、商用利用が完全に自由に
- **UIツールチップ追加** - すべてのボタンにマウスホバーで説明を表示
- **超コンパクトUI** - ウィンドウ幅280pxの超省スペース設計
- **システムトレイツールチップ** - 処理状況をアイコンホバーで確認可能
- **ライセンス整備** - LICENSE、THIRD_PARTY_LICENSES.mdを追加
- **リポジトリクリーンアップ** - 不要ファイル削除、.gitignore更新

### v2.0.0 (2025-10-19)
- 多重起動防止機能を追加
- UIフォント拡大（視認性向上）
- アプリケーションアイコンを追加
- フィラー語「ごめん」「ごめんなさい」削除機能を追加
- ファイル移動後の処理済みリストクリア機能を追加

### v1.0.0
- 初回リリース
- 基本的な文字起こし機能
- フォルダ監視機能
- 話者分離機能
- LLM補正機能

## サポート

質問やサポートが必要な場合は、以下をご利用ください:
- GitHub Issues
- ドキュメント: `docs/`フォルダ

---

**開発**: Claude Code + Human
**最終更新**: 2025-10-19

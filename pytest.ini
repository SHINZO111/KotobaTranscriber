[pytest]
# テストディレクトリとファイルパターン
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# マーカー定義
markers =
    unit: Unit tests (fast, isolated tests)
    integration: Integration tests (tests with dependencies)
    production: Production readiness tests (comprehensive scenario tests)
    performance: Performance tests (memory, throughput)
    slow: Slow running tests
    gui: GUI-related tests requiring display
    gpu: Tests requiring GPU
    audio: Tests requiring audio files or devices
    network: Tests requiring network access
    skip_ci: Skip in CI environment

# 出力設定とオプション
console_output_style = progress
addopts =
    -v
    --strict-markers
    --tb=short
    --maxfail=5
    -p no:warnings
    --color=yes
    --cov=src
    --cov-report=html
    --cov-report=term-missing
    --cov-report=xml
    --cov-fail-under=65

# テストディレクトリの無視
norecursedirs =
    .git
    .tox
    .env
    .venv
    venv
    dist
    build
    *.egg
    __pycache__
    .pytest_cache
    .mypy_cache
    node_modules
    models

# PyQt5/GUI テスト設定
qt_api = pyside6

# ログ設定
log_cli = false
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

log_file = pytest.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] %(name)s:%(lineno)d - %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# タイムアウト設定（pytest-timeout）
timeout = 300
timeout_method = thread

# xfail設定
xfail_strict = false

# 最小Python バージョン
minversion = 7.0

[coverage:run]
source = src
omit =
    */venv/*
    */tests/*
    */site-packages/*
    */__pycache__/*
    */.venv/*
    */dist/*
    */build/*
    */models/*
    */main.py
    */realtime_tab.py
    */ui_responsive.py
    */vocabulary_dialog.py
    */main_window_enhanced.py
    */dark_theme.py
    */folder_monitor.py
    */qt_compat.py
    */meeting_mode.py
    */ui_enhancements.py
    */faster_whisper_engine.py
    */transcription_engine.py
    */llm_corrector_standalone.py
    */speaker_diarization_free.py
    */memory_optimizer.py
    */enhanced_folder_monitor.py
    */api_corrector.py
    */advanced_features.py
    */optimized_pipeline.py
    */enhanced_batch_processor.py
    */enhanced_export.py
    */export/*
    */__init__.py

[coverage:report]
precision = 2
show_missing = True
skip_covered = False

[coverage:html]
directory = htmlcov
